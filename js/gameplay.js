TH.Gameplay=function(){},TH.Gameplay.prototype={init:function(){TH.Gameplay.spawnAllowed=!0,TH.Gameplay.currentTimer=0},preload:function(){},create:function(){game.sound.remove(TH.bgMusic),shoot=game.add.audio("shoot"),coin=game.add.audio("coin"),blash=game.add.audio("blash"),game.add.image(game.world.centerX,game.world.centerY,"ingame_bg").anchor.set(.5),nextFire=0,fireRate=400,timer=game.time.create(),timerEvent=timer.add(20*Phaser.Timer.MINUTE,this.endTimer,this),timer.start(),game.physics.startSystem(Phaser.Physics.ARCADE),bullets=game.add.group(),bullets.enableBody=!0,bullets.physicsBodyType=Phaser.Physics.ARCADE,items=this.game.add.group(),items.enableBody=!0,items.physicsBodyType=Phaser.Physics.ARCADE,items.createMultiple(50,"item1"),items.setAll("checkWorldBounds",!0),items.setAll("outOfBoundsKill",!0),bombs=this.game.add.group(),bombs.enableBody=!0,bombs.physicsBodyType=Phaser.Physics.ARCADE,bombs.createMultiple(50,"bomb"),bombs.setAll("checkWorldBounds",!0),bombs.setAll("outOfBoundsKill",!0),bullets.createMultiple(50,"bullet"),bullets.setAll("checkWorldBounds",!0),bullets.setAll("outOfBoundsKill",!0),gun=game.add.sprite(35,game.world.height,"gun"),gun.x+=gun.width/2+30,gun.y-=gun.height/2+70,gun.anchor.set(.5),game.physics.enable(gun,Phaser.Physics.ARCADE),gun.body.allowRotation=!1,game.physics.arcade.enable([bullets,items]),game.physics.arcade.enable([bullets,bombs]),this.createEnemy();var e=game.add.image(game.world.centerX,0,"top_bar");e.anchor.set(.5),e.y+=e.height/2,live1=game.add.image(game.world.centerX+300,95,"live"),live1.anchor.set(.5),live1.scale.setTo(1,1),live1.x-=live1.width/2+65,live2=game.add.image(game.world.centerX+300,95,"live"),live2.anchor.set(.5),live2.scale.setTo(1,1),live3=game.add.image(game.world.centerX+300,95,"live"),live3.anchor.set(.5),live3.scale.setTo(1,1),live3.x+=live3.width/2+65,spacebarKey=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),scoreText=game.add.bitmapText(45,95,"spaceComics",TH.score,108),scoreText.setText(TH.score),scoreText.anchor.set(0,.5),emitter=game.add.emitter(game.world.centerX,-50,50),emitter.makeParticles("snow_ingame"),emitter.width=game.world.width,emitter.minParticleSpeed.setTo(10,30),emitter.maxParticleSpeed.setTo(85,100),emitter.minParticleScale=.5,emitter.maxParticleScale=1,emitter.gravity=150,emitter.start(!1,5e3,250),emitter.setAlpha(1,0,5e3)},update:function(){TH.isGameOver||(TH.Gameplay.currentTimer=1200-Math.round((timerEvent.delay-timer.ms)/1e3),game.input.activePointer.isDown&&this.fire(),game.physics.arcade.overlap(bullets,items,this.collisionHandler,null,this),game.physics.arcade.overlap(bullets,bombs,this.bombCollisionHandler,null,this))},endTimer:function(){timer.stop()},formatTime:function(e){var a="0"+Math.floor(e/60),t="0"+(e-60*a);return a.substr(-2)+":"+t.substr(-2)},fire:function(){if(!TH.isGameOver&&this.time.now>nextFire&&bullets.countDead()>0){1==TH.sound&&shoot.play(),nextFire=this.time.now+fireRate;var e=bullets.getFirstDead();e.reset(gun.x-8,gun.y-8),e.scale.setTo(1),game.physics.arcade.moveToXY(e,game.world.width,-50,1200,500)}},createEnemy:function(){if(TH.Gameplay.spawnAllowed){var e;if(0==game.rnd.integerInRange(0,1)){e=items.getFirstDead();var a=game.rnd.integerInRange(1,11);e.loadTexture("item"+a),e.name="item"+a,e.scale.setTo(1)}else(e=bombs.getFirstDead()).name="bomb",e.scale.setTo(1);e.reset(0,0),e.anchor.set(.5),this.game.add.tween(e).to({x:[0,22,33,50,72,94,122,159,220,267,334,399,440,477,524,619,706,759,814,865,895,920,926,920,904,853,789,722,655,611,552,488,415,354,309,251,231,214,237,270,306,343,399,457,516,572,636,669,728,778,828,876,898,920,940,926,918,912,893,859,859],y:[0,70,98,151,199,235,277,296,319,330,347,347,349,349,344,333,330,338,360,391,425,478,534,589,651,707,746,757,768,771,782,796,818,838,868,907,963,1039,1075,1134,1167,1187,1203,1223,1242,1242,1259,1270,1295,1318,1360,1418,1480,1560,1653,1717,1798,1845,1881,1907,2050]},this.getItemSpeed(),Phaser.Easing.Linear.In,!0).interpolation(function(e,a){return Phaser.Math.bezierInterpolation(e,a)}).onComplete.add(function(){e.kill(),e.name.startsWith("item")&&(TH.live-=1,2===TH.live?live3.visible=!1:1===TH.live?live2.visible=!1:TH.live<=0&&(live1.visible=!1,game.state.start("Result")))},this),this.game.time.events.add(this.getItemSpawnTime(),this.createEnemy,this)}},collisionHandler:function(e,a){if(a.name.startsWith("item")){1==TH.sound&&coin.play();var t=game.add.sprite(a.centerX,a.centerY,"fire");t.scale.setTo(1.75,1.75),t.anchor.set(.5);var r=t.animations.add("explosion");t.animations.play("explosion",24,!1),r.killOnComplete=!0,TH.score+=5,this.processAchievement(a.name),scoreText.setText(TH.score),e.kill(),a.loadTexture(a.name+"_open"),a.name="collected"}else a.name.startsWith("collected")&&e.kill()},processAchievement:function(e){TH.achievement.push(e),TH.hashKey=md5(TH.achievement.toString())},bombCollisionHandler:function(e,a){a.loadTexture(a.name+"_open");var t=game.add.sprite(a.centerX,a.centerY,"boom");t.scale.setTo(1.75,1.75),t.anchor.set(.5);var r=t.animations.add("blash");t.animations.play("blash",16,!1),r.killOnComplete=!0,e.kill(),a.kill(),this.gameOver()},getItemSpawnTime:function(){return TH.Gameplay.currentTimer<=10?game.rnd.integerInRange(650,750):TH.Gameplay.currentTimer>10&&TH.Gameplay.currentTimer<=20?game.rnd.integerInRange(550,650):TH.Gameplay.currentTimer<=30&&TH.Gameplay.currentTimer>20?game.rnd.integerInRange(450,550):TH.Gameplay.currentTimer<=40&&TH.Gameplay.currentTimer>30?game.rnd.integerInRange(450,550):TH.Gameplay.currentTimer<=50&&TH.Gameplay.currentTimer>40?game.rnd.integerInRange(350,450):TH.Gameplay.currentTimer<=60&&TH.Gameplay.currentTimer>50?game.rnd.integerInRange(250,350):TH.Gameplay.currentTimer<=70&&TH.Gameplay.currentTimer>60?game.rnd.integerInRange(230,250):TH.Gameplay.currentTimer<=80&&TH.Gameplay.currentTimer>70?game.rnd.integerInRange(200,230):TH.Gameplay.currentTimer<=90&&TH.Gameplay.currentTimer>80?game.rnd.integerInRange(180,200):TH.Gameplay.currentTimer<=100&&TH.Gameplay.currentTimer>90?game.rnd.integerInRange(160,180):TH.Gameplay.currentTimer>100?game.rnd.integerInRange(140,160):game.rnd.integerInRange(650,750)},getItemSpeed:function(){return TH.Gameplay.currentTimer<=10?3e3:TH.Gameplay.currentTimer<=20&&TH.Gameplay.currentTimer>10?2800:TH.Gameplay.currentTimer<=30&&TH.Gameplay.currentTimer>20?2600:TH.Gameplay.currentTimer<=40&&TH.Gameplay.currentTimer>30?2400:TH.Gameplay.currentTimer<=50&&TH.Gameplay.currentTimer>40?2200:TH.Gameplay.currentTimer<=60&&TH.Gameplay.currentTimer>50?2e3:TH.Gameplay.currentTimer<=70&&TH.Gameplay.currentTimer>60?1900:TH.Gameplay.currentTimer<=80&&TH.Gameplay.currentTimer>70?1800:TH.Gameplay.currentTimer>80?1700:3e3},goToResult:function(){game.state.start("Result")},gameOver:function(){1==TH.sound&&blash.play(),TH.isGameOver=!0,game.tweens.removeAll(),this.game.time.events.removeAll(),this.game.time.events.add(2e3,this.goToResult,this)}};